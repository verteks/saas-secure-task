# Demo project Playframework 2 Secure

## Обзор
Данная лабораторная предназначена для отработки навыков программирования в PlayFramework2

- Работа с сессией
- Аутентификация
- Авторизация
- Безопасное хранение паролей
- WebJars
- Twitter Bootstrap
- JQuery

## Сборка и запуск
Для генерации секрета приложения введите

```bash
$ sbt play-generate-secret
```
Для создания проекта IntelliJ Idea введите команду

```bash
$ sbt idea
```

Для запуска приложения из консоли, введите команду 
```bash
$ sbt run
```

## Инструкции

Не забудьте перед началом работы сгенерировать новый секрет приложения для валидации сессии на стороне сервера.

### User
Данный класс находится в пакете models. Он реаизует главную сущность приложения - модель пользователя. Для вас реализованы основные утилитарные функции приложения, связанные с криптографией - генерация хэша SHA-1, SHA-2, генерация соли. Для каждого пользователя в системе должно храниться три поля - email, используемый для идентификации, хэш пароля passwordHash и соль salt. Для реализации приложения по коду разбросаны комментарии
```java
//todo Инструкции по реализации
```
Для начала необходимо реализовать собственный метод _getHash_ используя выбранный алгоритм хэш-функции.

Далее, используя _getHash_ перейти к реализации функции setPassword, которая предназначена для смены пароля. На вход принимает пароль открытым текстом, необходимо сгенерировать соль, используя функцию _getSalt_, затем вычислить хэш от подсоленного пароля.

Для реализации механизма проверки пароля, необходимо дописать фукнцию _checkPassword_. Она должна принимать на вход пароль, добавлять к нему соль, вычислять хэш и сравнивать хэш с сохраненным значением. В случае совпадения возвращаем _true_.

Функцию проверки пароля будем использовать в механизме аутентификации, реализовав функцию _authenticate_, которая по контракту принимает email и пароль, а возвращает текст ошибки аутентификации. В случае успеха аутентификации возвращает _null_. 

> Примечание: для всех поисковых операций используем Finder-поле find. Это стандартный паттерн для работы с моделью в PlayFramework.

1. Ищем пользователя с данным email в базе.
2. Если не находим, возвращаем ошибку "Пользователь с данным email не зарегистрирован"
3. Для найденного пользователя выполняем процедуру проверки пароля с помощью  _checkPassword_.
4. В случае несовпадения паролей, выдаем ошибку "Не верный пароль"

> Примечание: в современной практике считается, что безопаснее выдавать одинаковый текст ошибки в обоих случаях провала аутентификации, чтобы не возможно было провести анализ, какие почтовые ящики зарегистрированы. Обычно выводится текст ошибки, вроде "Неверный логин или пароль".

Последний метод класса User, который необходимо реализовать - это _emailAvailable_, который используется в механизме регистрации для проверки, что данный email уже зарегистрирован в системе.

### Login

Данный класс находится в пакете models. Он предназначен для валидации формы аутентификации (логина), входа в систему. 

Необходимо добавить аннотации для пароля, сделать его обязательным.
Добавить человеческое сообщение для текстов ошибки валидации отдельных полей. См. как это сделано для поля 
```java
  @Email(message = "Некорректный адрес электронной почты")
  @Required
  public String email;
```

Реализуйте функцию validate, используя User.authenticate

### Register
Данный класс находися в пакете models. Он предназначен для валидации формы регистрации.

1. Добавьте необходимые аннотации с сообщениями об ошибках, для корректной работы валидации.
2. Реализуйте механизм валидации формы, которая кроме проверки обязательных полей, ищет данный email среди зарегистрированных.

> Подсказка: используйте User.emailAvailable(email)

### ChangePassword

Данный класс находится в пакете models. Он предназначен для валидации формы смены пароля в профиле пользователя.

1. Добавьте необходимые аннотации для полей.
2. Реализуйте метод validate, который проверяет, что пользователь аутентифицирован.

> Подсказка: Воспользуйтесь методами Auth.currentUserEmail и Auth.currentUser для получения текущего пользователя и его email

###Auth
Данный класс находится в пакете controllers и предназначен для обработки запросов к серверу по регистрации, аутенификации, и смене пароля.

Для начала изучите метод auth. Этот метод обрабатывает форму логина. В нем демонстрируется три вида техник:

1. Валидация формы на основе класса Login
2. Занесение данных в сессию с помощью метода session(key, value)
3. Добавление данных в flash-память для отрисовки алертов.

Затем, вам необходимо самостоятельно реализовать метод login. Данный метод проверяет, является ли пользователь аутентифицированным, если да, то перенаправляет на главную страницу  Application.index(). Если нет, то выдает пустую форму для ввода логина/пароля.

Метод logout производит стирание сессии и перенаправление на главную страницу. Реализуйте его.
> Подсказка: используйте метод session.clear()

Метод signup производит обработку формы регистрации. Используется класса models.Register. В случае успеха, пользователь добавляется в базу, и производится аутентификация путем доавления email в сессию. Реализуйте данный метод, учитывая его контракт.

### Secured

Данный класс находится в пакете util. Он предназначен для реализации интерфейса Security.Authenticator для навешивания проверок безопасности на защищаемые методы контроллера. Данный интерфейс состоит из двух методов

```java
// Проверяет, что пользователь прошел аутентификацию. Возвращает строку-логин пользователя в случае, если он является аутентифицированным.
public String getUsername(Context ctx) {}

// Метод перенаправляет пользователя на механизм логина, в случае, если getUsername вернул null и пользователь является не аутентифицированным.
public Result onUnauthorized(Context ctx) {}
```

Реализуйте данные методы, используя изученные функции работы с сессией и контроллеры перенаправления/редиректа.

### Admin

Данный класс находится в пакете controllers. Он предназначен для закрытых разделов сайта (доступных только аутентифицированным пользователям). Авториация проводится с помощью класса Secured. Для этого используется аннотация
```java
@Security.Authenticated(Secured.class)
public class Admin extends Controller{

}
```

В данном классе два метода
```java
// Страница профиля пользователя
public static Result profile() {}
// Обработка формы смены пароля
public static Result changePassword() {}
```

Реализуйте данные методы.

###
